{
	"info": {
		"_postman_id": "dispatch-guides-api-v1",
		"name": "SUNAT API v1 - Guías de Remisión",
		"description": "Colección completa para probar las guías de remisión electrónicas con la API SUNAT v1. Incluye ejemplos para transporte público, privado, traslados entre establecimientos y validaciones.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Catálogos y Referencias",
			"item": [
				{
					"name": "Obtener Motivos de Traslado",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides/catalogs/transfer-reasons",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides",
								"catalogs",
								"transfer-reasons"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has transfer reasons\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.success).to.be.true;",
									"    pm.expect(responseJson.data).to.be.an('array');",
									"    pm.expect(responseJson.data.length).to.be.greaterThan(10);",
									"});",
									"",
									"pm.test(\"Has required transfer reason codes\", function () {",
									"    const responseJson = pm.response.json();",
									"    const codes = responseJson.data.map(item => item.code);",
									"    pm.expect(codes).to.include('01'); // Venta",
									"    pm.expect(codes).to.include('02'); // Compra", 
									"    pm.expect(codes).to.include('04'); // Traslado entre establecimientos",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "Obtener Modalidades de Transporte",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides/catalogs/transport-modes",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides",
								"catalogs",
								"transport-modes"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has transport modes\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.success).to.be.true;",
									"    pm.expect(responseJson.data).to.be.an('array');",
									"    pm.expect(responseJson.data.length).to.equal(2);",
									"});",
									"",
									"pm.test(\"Has public and private transport\", function () {",
									"    const responseJson = pm.response.json();",
									"    const codes = responseJson.data.map(item => item.code);",
									"    pm.expect(codes).to.include('01'); // Transporte público",
									"    pm.expect(codes).to.include('02'); // Transporte privado",
									"});"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "2. Crear Guías de Remisión",
			"item": [
				{
					"name": "Crear Guía - Transporte Privado (Venta)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"client_id\": 1,\n  \"serie\": \"T001\",\n  \"fecha_emision\": \"2025-09-06\",\n  \"fecha_traslado\": \"2025-09-07\",\n  \"version\": \"2022\",\n  \n  \"cod_traslado\": \"01\",\n  \"des_traslado\": \"Venta\",\n  \"mod_traslado\": \"02\",\n  \"peso_total\": 45.500,\n  \"und_peso_total\": \"KGM\",\n  \"num_bultos\": 3,\n  \n  \"partida\": {\n    \"ubigeo\": \"150101\",\n    \"direccion\": \"AV LIMA 123, CERCADO DE LIMA\"\n  },\n  \"llegada\": {\n    \"ubigeo\": \"150203\", \n    \"direccion\": \"AV ARRIOLA 456, SAN MARTIN DE PORRES\"\n  },\n  \n  \"transportista\": null,\n  \"vehiculo\": {\n    \"placa_principal\": \"ABC123\",\n    \"placa_secundaria\": null,\n    \"conductor\": {\n      \"tipo\": \"Principal\",\n      \"tipo_doc\": \"1\",\n      \"num_doc\": \"12345678\",\n      \"licencia\": \"A12345678\",\n      \"nombres\": \"CARLOS ALBERTO\",\n      \"apellidos\": \"RODRIGUEZ TORRES\"\n    }\n  },\n  \n  \"detalles\": [\n    {\n      \"cantidad\": 10,\n      \"unidad\": \"NIU\",\n      \"descripcion\": \"PRODUCTO ELECTRÓNICO PORTÁTIL\",\n      \"codigo\": \"PROD001\",\n      \"peso_total\": 25.250\n    },\n    {\n      \"cantidad\": 5,\n      \"unidad\": \"NIU\",\n      \"descripcion\": \"ACCESORIO TECNOLÓGICO\",\n      \"codigo\": \"PROD002\", \n      \"peso_total\": 20.250\n    }\n  ],\n  \n  \"usuario_creacion\": \"POSTMAN_TEST\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Dispatch guide created successfully\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.success).to.be.true;",
									"    pm.expect(responseJson.data.id).to.exist;",
									"    pm.expect(responseJson.data.mod_traslado).to.equal('02');",
									"    pm.expect(responseJson.data.peso_total).to.equal(45.5);",
									"});",
									"",
									"// Guardar ID para siguientes requests",
									"if (pm.response.code === 201) {",
									"    const responseJson = pm.response.json();",
									"    pm.environment.set('dispatch_guide_private_id', responseJson.data.id);",
									"}"
								]
							}
						}
					]
				},
				{
					"name": "Crear Guía - Transporte Público (Compra)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"client_id\": 2,\n  \"serie\": \"T001\",\n  \"fecha_emision\": \"2025-09-06\",\n  \"fecha_traslado\": \"2025-09-07\",\n  \n  \"cod_traslado\": \"02\",\n  \"des_traslado\": \"Compra\",\n  \"mod_traslado\": \"01\",\n  \"peso_total\": 150.750,\n  \"und_peso_total\": \"KGM\",\n  \"num_bultos\": 10,\n  \n  \"partida\": {\n    \"ubigeo\": \"150101\",\n    \"direccion\": \"ALMACEN PROVEEDOR, AV INDUSTRIAL 789\"\n  },\n  \"llegada\": {\n    \"ubigeo\": \"150203\",\n    \"direccion\": \"ALMACEN PRINCIPAL, AV COMERCIAL 123\"\n  },\n  \n  \"transportista\": {\n    \"tipo_doc\": \"6\",\n    \"num_doc\": \"20123456789\", \n    \"razon_social\": \"TRANSPORTES PROFESIONALES SAC\",\n    \"nro_mtc\": \"MTC001234\"\n  },\n  \"vehiculo\": {\n    \"placa_principal\": \"TPU456\",\n    \"placa_secundaria\": null\n  },\n  \n  \"detalles\": [\n    {\n      \"cantidad\": 100,\n      \"unidad\": \"NIU\",\n      \"descripcion\": \"MATERIA PRIMA INDUSTRIAL\",\n      \"codigo\": \"MP001\",\n      \"peso_total\": 150.750\n    }\n  ],\n  \n  \"usuario_creacion\": \"POSTMAN_TEST\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Public transport dispatch guide created\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.success).to.be.true;",
									"    pm.expect(responseJson.data.mod_traslado).to.equal('01');",
									"    pm.expect(responseJson.data.transportista).to.exist;",
									"});",
									"",
									"// Guardar ID para siguientes requests",
									"if (pm.response.code === 201) {",
									"    const responseJson = pm.response.json();",
									"    pm.environment.set('dispatch_guide_public_id', responseJson.data.id);",
									"}"
								]
							}
						}
					]
				},
				{
					"name": "Crear Guía - Traslado Entre Establecimientos",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"client_id\": 1,\n  \"serie\": \"T001\", \n  \"fecha_emision\": \"2025-09-06\",\n  \"fecha_traslado\": \"2025-09-07\",\n  \n  \"cod_traslado\": \"04\",\n  \"des_traslado\": \"Traslado entre establecimientos de la misma empresa\",\n  \"mod_traslado\": \"02\",\n  \"peso_total\": 85.000,\n  \"und_peso_total\": \"KGM\",\n  \"num_bultos\": 5,\n  \n  \"partida\": {\n    \"ubigeo\": \"150101\",\n    \"direccion\": \"ALMACEN CENTRAL - AV LIMA 100\"\n  },\n  \"llegada\": {\n    \"ubigeo\": \"150203\",\n    \"direccion\": \"SUCURSAL NORTE - AV INDUSTRIAL 200\"\n  },\n  \n  \"vehiculo\": {\n    \"placa_principal\": \"EMP789\",\n    \"conductor\": {\n      \"tipo\": \"Principal\",\n      \"tipo_doc\": \"1\", \n      \"num_doc\": \"87654321\",\n      \"licencia\": \"B87654321\",\n      \"nombres\": \"MIGUEL ANGEL\",\n      \"apellidos\": \"SANCHEZ TORRES\"\n    }\n  },\n  \n  \"detalles\": [\n    {\n      \"cantidad\": 50,\n      \"unidad\": \"NIU\",\n      \"descripcion\": \"INVENTARIO PARA SUCURSAL\",\n      \"codigo\": \"INV001\",\n      \"peso_total\": 85.000\n    }\n  ],\n  \n  \"usuario_creacion\": \"POSTMAN_TEST\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Same company transfer created\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.success).to.be.true;",
									"    pm.expect(responseJson.data.cod_traslado).to.equal('04');",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    const responseJson = pm.response.json();",
									"    pm.environment.set('dispatch_guide_transfer_id', responseJson.data.id);",
									"}"
								]
							}
						}
					]
				},
				{
					"name": "Crear Guía - Con Vehículos Secundarios",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"client_id\": 3,\n  \"serie\": \"T001\",\n  \"fecha_emision\": \"2025-09-06\",\n  \"fecha_traslado\": \"2025-09-07\",\n  \n  \"cod_traslado\": \"01\",\n  \"des_traslado\": \"Venta\",\n  \"mod_traslado\": \"02\",\n  \"peso_total\": 250.500,\n  \"und_peso_total\": \"KGM\",\n  \"num_bultos\": 20,\n  \n  \"partida\": {\n    \"ubigeo\": \"150101\",\n    \"direccion\": \"PLANTA DE PRODUCCIÓN\"\n  },\n  \"llegada\": {\n    \"ubigeo\": \"150203\", \n    \"direccion\": \"CENTRO DE DISTRIBUCIÓN\"\n  },\n  \n  \"vehiculo\": {\n    \"placa_principal\": \"VEH001\",\n    \"placa_secundaria\": [\"VEH002\", \"VEH003\"],\n    \"conductor\": {\n      \"tipo\": \"Principal\",\n      \"tipo_doc\": \"1\",\n      \"num_doc\": \"11111111\",\n      \"licencia\": \"A11111111\", \n      \"nombres\": \"PEDRO LUIS\",\n      \"apellidos\": \"MARTINEZ SILVA\"\n    }\n  },\n  \n  \"detalles\": [\n    {\n      \"cantidad\": 200,\n      \"unidad\": \"NIU\",\n      \"descripcion\": \"CARGA INDUSTRIAL PESADA\",\n      \"codigo\": \"HEAVY001\",\n      \"peso_total\": 250.500\n    }\n  ],\n  \n  \"usuario_creacion\": \"POSTMAN_TEST\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Heavy load dispatch guide created\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.success).to.be.true;",
									"    pm.expect(responseJson.data.peso_total).to.equal(250.5);",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    const responseJson = pm.response.json();",
									"    pm.environment.set('dispatch_guide_heavy_id', responseJson.data.id);",
									"}"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "3. Consultar Guías de Remisión",
			"item": [
				{
					"name": "Listar Todas las Guías",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains dispatch guides list\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.success).to.be.true;",
									"    pm.expect(responseJson.data.data).to.be.an('array');",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "Filtrar por Estado SUNAT",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides?estado_sunat=PENDIENTE",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides"
							],
							"query": [
								{
									"key": "estado_sunat",
									"value": "PENDIENTE"
								}
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"All guides are PENDIENTE\", function () {",
									"    const responseJson = pm.response.json();",
									"    const guides = responseJson.data.data;",
									"    guides.forEach(guide => {",
									"        pm.expect(guide.estado_sunat).to.equal('PENDIENTE');",
									"    });",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "Filtrar por Modalidad de Transporte",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides?mod_traslado=02",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides"
							],
							"query": [
								{
									"key": "mod_traslado",
									"value": "02"
								}
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"All guides are private transport\", function () {",
									"    const responseJson = pm.response.json();",
									"    const guides = responseJson.data.data;",
									"    guides.forEach(guide => {",
									"        pm.expect(guide.mod_traslado).to.equal('02');",
									"    });",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "Obtener Guía Específica",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides/{{dispatch_guide_private_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides",
								"{{dispatch_guide_private_id}}"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains dispatch guide details\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.success).to.be.true;",
									"    pm.expect(responseJson.data.id).to.exist;",
									"    pm.expect(responseJson.data.company).to.exist;",
									"    pm.expect(responseJson.data.destinatario).to.exist;",
									"});"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "4. Procesamiento SUNAT",
			"item": [
				{
					"name": "Enviar a SUNAT - Transporte Privado",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides/{{dispatch_guide_private_id}}/send-sunat",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides",
								"{{dispatch_guide_private_id}}",
								"send-sunat"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Request processed\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 400]);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Dispatch guide sent to SUNAT\", function () {",
									"        const responseJson = pm.response.json();",
									"        pm.expect(responseJson.success).to.be.true;",
									"        pm.expect(responseJson.data.estado_sunat).to.be.oneOf(['PROCESANDO', 'ACEPTADO']);",
									"        ",
									"        if (responseJson.ticket) {",
									"            pm.environment.set('sunat_ticket', responseJson.ticket);",
									"        }",
									"    });",
									"} else {",
									"    pm.test(\"Error handled correctly\", function () {",
									"        const responseJson = pm.response.json();",
									"        pm.expect(responseJson.success).to.be.false;",
									"        console.log('Error:', responseJson.message);",
									"    });",
									"}"
								]
							}
						}
					]
				},
				{
					"name": "Consultar Estado SUNAT",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides/{{dispatch_guide_private_id}}/check-status",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides",
								"{{dispatch_guide_private_id}}",
								"check-status"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Request processed\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 400]);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Status checked successfully\", function () {",
									"        const responseJson = pm.response.json();",
									"        pm.expect(responseJson.success).to.be.true;",
									"        pm.expect(responseJson.data.estado_sunat).to.exist;",
									"    });",
									"} else {",
									"    pm.test(\"Error handled correctly\", function () {",
									"        const responseJson = pm.response.json();",
									"        pm.expect(responseJson.success).to.be.false;",
									"        console.log('Status check error:', responseJson.message);",
									"    });",
									"}"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "5. Generar y Descargar Archivos",
			"item": [
				{
					"name": "Generar PDF",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides/{{dispatch_guide_private_id}}/generate-pdf",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides",
								"{{dispatch_guide_private_id}}",
								"generate-pdf"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"PDF generated successfully\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.success).to.be.true;",
									"    pm.expect(responseJson.data.id).to.exist;",
									"    pm.expect(responseJson.data.pdf_path).to.exist;",
									"    pm.expect(responseJson.data.download_url).to.exist;",
									"});",
									"",
									"pm.test(\"PDF data structure is correct\", function () {",
									"    const responseJson = pm.response.json();",
									"    const data = responseJson.data;",
									"    ",
									"    pm.expect(data.serie).to.exist;",
									"    pm.expect(data.correlativo).to.exist;",
									"    pm.expect(data.numero_documento).to.exist;",
									"    pm.expect(data.fecha_emision).to.exist;",
									"    pm.expect(data.fecha_traslado).to.exist;",
									"    pm.expect(data.peso_total).to.exist;",
									"    pm.expect(data.modalidad_traslado).to.exist;",
									"    pm.expect(data.motivo_traslado).to.exist;",
									"    pm.expect(data.destinatario).to.exist;",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "Descargar XML",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides/{{dispatch_guide_private_id}}/download-xml",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides",
								"{{dispatch_guide_private_id}}",
								"download-xml"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Request processed\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test(\"XML file downloaded\", function () {",
									"        pm.expect(pm.response.headers.get('Content-Type')).to.include('xml');",
									"    });",
									"} else {",
									"    pm.test(\"XML not found (expected for new guides)\", function () {",
									"        const responseJson = pm.response.json();",
									"        pm.expect(responseJson.success).to.be.false;",
									"        pm.expect(responseJson.message).to.include('XML no encontrado');",
									"    });",
									"}"
								]
							}
						}
					]
				},
				{
					"name": "Descargar CDR",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides/{{dispatch_guide_private_id}}/download-cdr",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides",
								"{{dispatch_guide_private_id}}",
								"download-cdr"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Request processed\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test(\"CDR file downloaded\", function () {",
									"        pm.expect(pm.response.headers.get('Content-Disposition')).to.exist;",
									"    });",
									"} else {",
									"    pm.test(\"CDR not found (expected for unprocessed guides)\", function () {",
									"        const responseJson = pm.response.json();",
									"        pm.expect(responseJson.success).to.be.false;",
									"        pm.expect(responseJson.message).to.include('CDR no encontrado');",
									"    });",
									"}"
								]
							}
						}
					]
				},
				{
					"name": "Descargar PDF",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides/{{dispatch_guide_private_id}}/download-pdf",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides",
								"{{dispatch_guide_private_id}}",
								"download-pdf"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Request processed\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test(\"PDF file downloaded\", function () {",
									"        pm.expect(pm.response.headers.get('Content-Type')).to.include('pdf');",
									"    });",
									"} else {",
									"    pm.test(\"PDF not found (run generate PDF first)\", function () {",
									"        const responseJson = pm.response.json();",
									"        pm.expect(responseJson.success).to.be.false;",
									"        pm.expect(responseJson.message).to.include('PDF no encontrado');",
									"    });",
									"}"
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "6. Casos de Error y Validación",
			"item": [
				{
					"name": "Error - Transporte Privado Sin Conductor",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"client_id\": 1,\n  \"serie\": \"T001\",\n  \"fecha_emision\": \"2025-09-06\",\n  \"fecha_traslado\": \"2025-09-07\",\n  \n  \"cod_traslado\": \"01\",\n  \"des_traslado\": \"Venta\",\n  \"mod_traslado\": \"02\",\n  \"peso_total\": 30.0,\n  \"und_peso_total\": \"KGM\",\n  \"num_bultos\": 2,\n  \n  \"partida\": {\n    \"ubigeo\": \"150101\",\n    \"direccion\": \"ORIGEN\"\n  },\n  \"llegada\": {\n    \"ubigeo\": \"150203\",\n    \"direccion\": \"DESTINO\"\n  },\n  \n  \"vehiculo\": {\n    \"placa_principal\": \"ABC123\"\n  },\n  \n  \"detalles\": [\n    {\n      \"cantidad\": 1,\n      \"unidad\": \"NIU\",\n      \"descripcion\": \"PRODUCTO\",\n      \"codigo\": \"PROD001\",\n      \"peso_total\": 30.0\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 422\", function () {",
									"    pm.response.to.have.status(422);",
									"});",
									"",
									"pm.test(\"Validation errors for conductor data\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.errors).to.exist;",
									"    // Específicos errors dependen de la implementación de validación",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "Error - Transporte Público Sin Transportista",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"client_id\": 1,\n  \"serie\": \"T001\",\n  \"fecha_emision\": \"2025-09-06\",\n  \"fecha_traslado\": \"2025-09-07\",\n  \n  \"cod_traslado\": \"01\",\n  \"des_traslado\": \"Venta\",\n  \"mod_traslado\": \"01\",\n  \"peso_total\": 30.0,\n  \"und_peso_total\": \"KGM\",\n  \"num_bultos\": 2,\n  \n  \"partida\": {\n    \"ubigeo\": \"150101\",\n    \"direccion\": \"ORIGEN\"\n  },\n  \"llegada\": {\n    \"ubigeo\": \"150203\",\n    \"direccion\": \"DESTINO\"\n  },\n  \n  \"vehiculo\": {\n    \"placa_principal\": \"ABC123\"\n  },\n  \n  \"detalles\": [\n    {\n      \"cantidad\": 1,\n      \"unidad\": \"NIU\",\n      \"descripcion\": \"PRODUCTO\",\n      \"codigo\": \"PROD001\",\n      \"peso_total\": 30.0\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 422\", function () {",
									"    pm.response.to.have.status(422);",
									"});",
									"",
									"pm.test(\"Validation errors for transportista data\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.errors).to.exist;",
									"});"
								]
							}
						}
					]
				},
				{
					"name": "Error - Guía No Encontrada",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispatch-guides/99999",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispatch-guides",
								"99999"
							]
						}
					},
					"response": [],
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 404\", function () {",
									"    pm.response.to.have.status(404);",
									"});",
									"",
									"pm.test(\"Error message correct\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.success).to.be.false;",
									"    pm.expect(responseJson.message).to.include('no encontrada');",
									"});"
								]
							}
						}
					]
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Pre-request script global",
					"console.log('Ejecutando request:', pm.info.requestName);"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Test script global",
					"pm.test(\"Response time is acceptable\", function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(10000);",
					"});",
					"",
					"pm.test(\"Response has correct headers\", function () {",
					"    pm.expect(pm.response.headers.get('Content-Type')).to.include('json');",
					"});"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string"
		}
	]
}